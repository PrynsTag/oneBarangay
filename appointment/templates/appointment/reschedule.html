<!DOCTYPE html>
{% load poll_extras %}
{% load static %}

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Reschedule Appointment</title>

        <!-- Vendors -->
        <link href="{% static "/assets/vendor/sweetalert2/dist/sweetalert2.min.css" %}" rel="stylesheets" type="text/css">
        <link href="{% static "/assets/vendor/notyf/notyf.min.css" %}" rel="stylesheet" type="text/css">

        <!-- Vendors -->
        <link href="{% static "/assets/vendor/sweetalert2/dist/sweetalert2.min.css" %}" rel="stylesheets" type="text/css">
        <link href="{% static "/assets/vendor/notyf/notyf.min.css" %}" rel="stylesheet" type="text/css">

        <!-- Stylesheets -->
        <link href="{% static "/assets/css/volt.css" %}" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

        <!-- Custom Style -->
        <link rel="stylesheet" href="{% static "appointment/assets/css/resched.css" %}">
    </head>
    <body>

        {% include "includes/sidebar.html" %}

        <main class="content">
            {% include "includes/navigation.html" %}

            <h1>Reschedule Appointments</h1>

            <h2><input class="date_picker" type="text" id="basicDate" data-input></h2>

            {% if is_today %}
                <a href="javascript:void(0);" disabled="true">Previous</a>
            {% else %}
                <a href="{% url "appointment:appointment_resched" document_id previous %}">Previous</a>
            {% endif %}
            <a href="{% url "appointment:appointment_resched" document_id current_date %}">Current</a>
            <a href="{% url "appointment:appointment_resched" document_id today %}">Today</a>
            <a href="{% url "appointment:appointment_resched" document_id next %}">Next</a>

            <div class="container-fluid px-0 px-sm-4 mx-auto">
                <div class="row justify-content-center mx-0">
                    <div class="col-lg-10">
                        <div class="card border-0">
                            <form method="POST" action="{% url "appointment:user_resched" document_id %}">
                                {% csrf_token %}
                                <div class="card-body p-3 p-sm-5">
                                    <div class="row text-center mx-0">
                                        {% for user_list in appointment_list %}
                                            {% for user_info in user_list %}
                                                <div class="col-md-2 col-4 my-1 px-2">
                                                    {% if user_info.current_user %}
                                                        <label for="{{ user_info.start_appointment|datetime_to_time }}"
                                                            class="py-1 current-user disable-select ">{{ user_info.start_appointment|datetime_to_time }}</label>
                                                        <input class="py-1 current-user"
                                                            id="{{ user_info.start_appointment|datetime_to_time }}"
                                                            name="time" type="radio"
                                                            value="{{ user_info.document_id }}">
                                                    {% else %}
                                                        {% if user_info.available %}
                                                            <label for="{{ user_info.start_appointment|datetime_to_time }}"
                                                                class="cell py-1 disable-select ">{{ user_info.start_appointment|datetime_to_time }}</label>
                                                            <input class="time-cell py-1 available"
                                                                id="{{ user_info.start_appointment|datetime_to_time }}"
                                                                name="time" type="radio"
                                                                value="{{ user_info.document_id }}">
                                                        {% else %}
                                                            <label for="{{ user_info.start_appointment|datetime_to_time }}"
                                                                class="time-cell py-1 disabled disable-select ">{{ user_info.start_appointment|datetime_to_time }}</label>
                                                            <input class="time-cell py-1 disabled"
                                                                id="{{ user_info.start_appointment|datetime_to_time }}"
                                                                name="time" type="radio"
                                                                value="{{ user_info.document_id }}" disabled>
                                                        {% endif %}
                                                    {% endif %}
                                                </div>
                                            {% endfor %}
                                        {% endfor %}
                                        <input type="submit" name="reschedule" value="Reschedule">
                                        <a href="{% url "appointment:request" document_id %}">Back</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            {% include "includes/settings-box.html" %}
            {% include "includes/footer.html" %}
        </main>


        <!-- jQuery -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
            integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

        <!--  Flatpickr  -->
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>


        <script type="text/javascript">
            let d = new Date(year ={{ curr_year }}, month = {{ curr_month }}, date ={{ curr_day }});
            {#console.log("{{ curr_day }}");#}
            console.log(d.toISOString());

            $("#basicDate").flatpickr({
                dateFormat: "l, F d, Y",
                minDate: "today",
                defaultDate: d.toISOString(),
                onChange: function (selectedDates, dateStr, instance) {
                    let dConsole = new Date(dateStr);
                    let year = dConsole.getFullYear();
                    let month = dConsole.getMonth();
                    let date = dConsole.getDate();

                    let pathName = (window.location.pathname);
                    pathName = pathName.split("/");
                    pathName[pathName.length - 1] = `${year}-${month + 1}-${date}`;
                    pathName = pathName.join("/");
                    let full_URL = window.location.origin + pathName;
                    window.location.href = full_URL;
                }
            });
        </script>
    </body>
</html>
