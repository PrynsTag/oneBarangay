{% extends "layouts/base.html" %}
{% block title %}{{ title }}{% endblock %}
{% load static %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css"
        integrity="sha256-DOS9W6NR+NFe1fUhEE0PGKY/fubbUCnOfTje2JMDw3Y=" crossorigin="anonymous"/>
    <style>
        ul#id_notification_type li {
            list-style: none;
            display: inline;
            margin-right: 10px;
        }

        ul {
            padding: 0;
        }

        .form-group label.required:after {
            content: " *";
            color: red;
        }
    </style>
{% endblock stylesheets %}

{% block content %}
    <div class="d-flex justify-content-between w-100 flex-wrap px-5 py-4">
        <div class="mb-3 mb-lg-0">
            <h1 class="h4">{{ title }}</h1>
            <p class="mb-0">Schedule mass events, appointments and notifications.</p>
        </div>
        <div>
            <a href="#" class="btn btn-outline-gray">
                <i class="fas fa-question-circle me-1"></i>Help
            </a>
        </div>
    </div>

    <div class="container py-4 w-50">
        <div class="card border-0 shadow components-section">
            <div class="card-body">
                <form action="" method="post" id="bulk-sched-form">
                    {% csrf_token %}

                    {% if form.non_field_errors %}
                        <div class="alert alert-danger" role="alert">
                            {% for error in form.non_field_errors %}
                                <p class="text-center">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <div class="row mb-4">
                        <div class="form-group col">
                            {{ form.event.label_tag }}
                            <div class="input-group justify-content-start">
                                <span class="input-group-text">
                                    <i class="fas fa-bullhorn"></i>
                                </span>
                                {{ form.event }}
                                {% if form.event.errors %}
                                    <div>
                                        <div class="badge m-0 bg-danger text-uppercase">
                                            {{ form.event.errors|striptags }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="form-group col">
                            {{ form.resident_quantity.label_tag }}
                            <div class="input-group justify-content-start">
                                <span class="input-group-text">
                                    <i class="fas fa-balance-scale"></i>
                                </span>
                                {{ form.resident_quantity }}
                                {% if form.resident_quantity.errors %}
                                    <div>
                                        <div class="badge m-0 bg-danger text-uppercase">
                                            {{ form.resident_quantity.errors|striptags }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="form-group col">
                            <div class="row">
                                {{ form.notification_type.label_tag }}
                                <div class="input-group justify-content-start">
                                    {{ form.notification_type }}
                                </div>
                                {% if form.notification_type.errors %}
                                    <div>
                                        <div class="badge m-0 bg-danger text-uppercase">
                                            {{ form.notification_type.errors|striptags }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="form-group col">
                            {{ form.relationship_type.label_tag }}
                            <div class="input-group justify-content-start">
                                <span class="input-group-text">
                                    <i class="fas fa-people-arrows"></i>
                                </span>
                                {{ form.relationship_type }}
                                {% if form.relationship_type.errors %}
                                    <div>
                                        <div class="badge m-0 bg-danger text-uppercase">
                                            {{ form.relationship_type.errors|striptags }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="form-group col">
                            {{ form.street.label_tag }}
                            <div class="input-group justify-content-start">
                                <span class="input-group-text">
                                    <i class="fas fa-road"></i>
                                </span>
                                {{ form.street }}
                                {% if form.street.errors %}
                                    <div>
                                        <div class="badge m-0 bg-danger text-uppercase">
                                            {{ form.street.errors|striptags }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="form-group col">
                            {{ form.time_interval.label_tag }}
                            <div class="input-group justify-content-start">
                                <span class="input-group-text">
                                    <i class="fas fa-clock"></i>
                                </span>
                                {{ form.time_interval }}
                                {% if form.time_interval.errors %}
                                    <div>
                                        <div class="badge m-0 bg-danger text-uppercase">
                                            {{ form.time_interval.errors|striptags }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col">
                            {{ form.start_date.label_tag }}
                            <div class="input-group justify-content-start">
                                <span class="input-group-text">
                                    <i class="fas fa-calendar-plus icon-box"></i>
                                </span>
                                {{ form.start_date }}
                                {% if form.start_date.errors %}
                                    <div>
                                        <div class="badge m-0 bg-danger text-uppercase">
                                            {{ form.start_date.errors|striptags }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="form-group col">
                            {{ form.end_date.label_tag }}
                            <div class="input-group justify-content-start">
                                <span class="input-group-text">
                                    <i class="fas fa-calendar-minus icon-box"></i>
                                </span>
                                {{ form.end_date }}
                                {% if form.end_date.errors %}
                                    <div>
                                        <div class="badge m-0 bg-danger text-uppercase">
                                            {{ form.end_date.errors|striptags }}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button type="reset" form="bulk-sched-form" href="{% url "announcement:home" %}" class="btn btn-danger">Cancel</button>
                        <button type="submit" form="bulk-sched-form" href="#" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock content %}

{% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js"
        integrity="sha256-FEqEelWI3WouFOo2VWP/uJfs1y8KJ++FLh2Lbqc8SJk="
        crossorigin="anonymous">
    </script>
    <script>
        $(function () {
            const $start_date = $('#id_start_date')
            const $end_date = $('#id_end_date')
            const start_date = document.getElementById('id_start_date')
            const end_date = document.getElementById('id_end_date')

            end_date.disabled = true
            $start_date.on('change', () => { end_date.disabled = !start_date.value; })

            $(function () {
                $start_date.datetimepicker({
                    format: 'Y-m-d H:i',
                    minDate: 0,
                    minTime: '8:00',
                    maxTime: '17:00',
                    step: 30,
                    defaultDate: Date.now(),
                    defaultTime: '8:00',
                    weeks: true,
                    onGenerate:function( ct ){
                        $(this).find('.xdsoft_date.xdsoft_weekend')
                            .addClass('xdsoft_disabled');
                    },
                    onShow: function (ct) {
                        this.setOptions({
                            maxDate: $end_date.val() ? $end_date.val() : false
                        })
                    },
                });
                $end_date.datetimepicker({
                    format: 'Y-m-d H:i',
                    minDate: 0,
                    minTime: '8:00',
                    maxTime: '17:00',
                    step: 30,
                    defaultDate: Date.now(),
                    defaultTime: '17:00',
                    onGenerate:function( ct ) {
                        $(this).find('.xdsoft_date.xdsoft_weekend')
                            .addClass('xdsoft_disabled');
                    },
                    onShow: function (ct) {
                        this.setOptions({
                            minDate: $start_date.val() ? $start_date.val() : false
                        })
                    },
                });
            });
        });
    </script>
{% endblock scripts %}
